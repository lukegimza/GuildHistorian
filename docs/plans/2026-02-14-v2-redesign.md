# Guild Historian v2.0 â€” Redesign

## Vision

Guild Historian becomes a real-time guild dashboard and achievement browser that reads directly from WoW's server-side data. No local event storage dependency. Works identically on any install, any machine, from the moment it loads.

The addon answers two questions:
1. "What's happening in my guild right now?" (Dashboard)
2. "What has my guild accomplished?" (Timeline)

## Architecture

### Data Philosophy

Primary data source: WoW API (server-side, persistent, reliable).

Local storage (SavedVariables) used only for:
- User preferences and settings
- Optional personal notes on events
- Display state (last viewed tab, window position)

### Core Data Modules

**AchievementScanner** â€” Iterates all guild achievement categories and IDs. For each completed achievement, captures name, description, points, icon, and completion date (month/day/year from `GetAchievementInfo`). Builds a sorted timeline of guild history going back to guild creation. Cached per session to avoid repeated iteration.

**NewsReader** â€” Calls `C_GuildInfo.QueryGuildNews()` then reads entries 1..`GetNumGuildNews()` via `C_GuildInfo.GetGuildNewsInfo(index)`. Each entry provides newsType, who, what, date, and guild members present. Covers recent weeks of boss kills, loot, and achievements.

**RosterReader** â€” Wraps `GetGuildRosterInfo(1..GetNumGuildMembers())`. Provides filtered views: online members, max-level members, members by class. Caches per roster update event.

**EventLogReader** â€” Reads the guild event log (join/leave/promote/demote) via `QueryGuildEventLog()` and `GetNumGuildEvents()` / `GetGuildEventInfo()`. Recent roster changes with dates.

### Removed Modules (from v1)

- Database write queue, flush cycle, dedup system
- BossKills event recorder
- LootTracker event recorder
- GuildRoster change detector
- Achievements event recorder
- MilestoneDetector
- Local event storage as primary data

These are replaced by the API reader modules above.

### Kept Modules (from v1)

- Notes (optional local annotations â€” user understands these are per-install)
- Settings/preferences
- MinimapButton (updated for new navigation)

## UI Design

### Navigation Model

Dashboard is the home screen. Timeline is a drill-down. Settings is a tab.

```
[ Dashboard ]  [ Timeline ]  [ Settings ]
     ^              ^
  home screen    drill-down
```

Opening the addon always lands on Dashboard. Timeline accessed via tab or by clicking activity items.

### Dashboard â€” Card Layout

Two-column grid with consistent card styling. Each card has a subtle border (matching the gold theme), a section title, and breathing room between cards. The dashboard scrolls vertically if content exceeds the frame.

#### Card: Guild Pulse (top-left, ~half width)

Purpose: Guild vital signs at a glance.

Data sources:
- `GetNumGuildMembers()` â†’ total members, online count
- `GetGuildInfo("player")` â†’ guild name
- Iterate guild achievements â†’ total points, completed count, total count

Display:
```
Guild Pulse
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
142 Members    23 Online
847 Achievement Points
Achievements: 156/412 (38%)
[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 38%
```

The achievement bar uses the gold accent color. Member count and online count are prominent numbers. Refreshes on `GUILD_ROSTER_UPDATE`.

#### Card: On This Day (top-right, ~half width)

Purpose: Surface historical guild achievements from this calendar date.

Data source:
- Iterate all guild achievements via `GetAchievementInfo`
- Filter where completed=true AND month matches today AND day matches today AND year < current year

Display (if matches found):
```
On This Day
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2 years ago:
  Guild earned "Stay Classy"

4 years ago:
  Guild earned "Guild Level 25"

Click to view in timeline â†’
```

Display (if no matches): Card is hidden entirely â€” no empty card wasting space.

Clicking navigates to Timeline tab filtered to that date.

#### Card: Recent Activity (middle, full width)

Purpose: Live guild activity feed from the server.

Data source:
- `C_GuildInfo.GetGuildNewsInfo(index)` â€” iterate latest entries
- Show most recent 8-10 entries
- News types: boss kills, loot, achievements, guild achievements

Display:
```
Recent Activity
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš”  PlayerA defeated Fyrakk (Mythic)           2h ago
ðŸ† PlayerB earned "Keystone Hero"              5h ago
ðŸ“¦ PlayerC received [Fyr'alath]                1d ago
âš”  Guild earned "Ahead of the Curve"          2d ago
â†’ View full timeline
```

Each row: colored icon (by event type), description, relative timestamp. Clicking "View full timeline" switches to Timeline tab. Clicking an entry could show a tooltip with details.

#### Card: Top Achievers (bottom-left, ~half width)

Purpose: Recognize high-contributing members.

Data source:
- `GetGuildRosterInfo(index)` â†’ achievement points per member
- Sort descending, take top 5

Display:
```
Top Achievers
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. PlayerA        42,850 pts
2. PlayerB        38,210 pts
3. PlayerC        35,990 pts
4. PlayerD        31,400 pts
5. PlayerE        28,750 pts
```

Names are class-colored via `RAID_CLASS_COLORS`. Refreshes on `GUILD_ROSTER_UPDATE`.

#### Card: Activity Snapshot (bottom-right, ~half width)

Purpose: Quick summary of recent guild activity by type.

Data source:
- Iterate guild news feed, count entries by newsType

Display:
```
Activity Snapshot
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Boss Kills       12
Achievements      8
Notable Loot      5
Guild Achieve.    2
```

Simple counts. No week-over-week comparison (feed coverage varies by guild activity level). Numbers colored by event type.

#### Card: Class Composition (full width)

Purpose: Who's online and raid-capable right now.

Data source:
- `GetGuildRosterInfo` filtered to: online=true AND level=`GetMaxPlayerLevel()`
- Group by classFileName

Display:
```
Online at Max Level (14 members)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[warrior x2] [paladin x3] [priest x2] [mage x1]
[warlock x2] [druid x1] [hunter x2] [evoker x1]
```

Each class shown with its icon and count, colored by class color. Classes with 0 online are omitted. Sub-max-level characters excluded.

#### Card: Achievement Progress (full width)

Purpose: How far along is the guild in each achievement category.

Data source:
- `GetCategoryList()` â†’ guild achievement categories
- `GetCategoryNumAchievements(categoryID, true)` â†’ total in category
- Iterate and count completed ones

Display:
```
Achievement Progress
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Raids & Dungeons    34/52  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘] 65%
PvP                 12/30  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 40%
Professions          8/20  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 40%
Reputation          15/25  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 60%
```

Categories sorted by completion percentage descending. Each bar uses the gold accent. Clicking a category could filter the timeline to show those achievements.

### Timeline View

A chronological, scrollable list combining:
1. Guild achievements (historical, from API â€” with real dates)
2. Guild news feed entries (recent, from API)
3. Guild event log entries (recent joins/leaves, from API)

All merged and sorted by date, newest first. Grouped by date headers.

Filter bar (kept from v1): search box, type toggles, date range presets.

Each entry shows: icon, title, description, relative time, and event-type color coding.

### Settings

Kept simple:
- Show/hide minimap icon
- Show/hide On This Day popup on login
- Dashboard card visibility toggles (hide cards you don't care about)

### Shared Card Styling

Every card follows the same pattern:
- Gold accent title with thin separator line below
- Dark semi-transparent background (consistent with frame backdrop)
- 8px internal padding
- 8px gap between cards
- Hover state: subtle background lighten
- All text uses standard WoW font templates for consistency

## Data Flow

```
Login
  â†’ GUILD_ROSTER_UPDATE fires
  â†’ RosterReader caches roster data
  â†’ AchievementScanner builds achievement cache (one-time per session)
  â†’ C_GuildInfo.QueryGuildNews() triggers GUILD_NEWS_UPDATE
  â†’ NewsReader caches news entries
  â†’ QueryGuildEventLog() triggers GUILD_EVENT_LOG_UPDATE
  â†’ EventLogReader caches event log
  â†’ Dashboard cards render from cached data
  â†’ On This Day popup checks achievement dates vs today

User opens addon
  â†’ Dashboard renders from cached data (instant, no API wait)
  â†’ Each card reads from its data module
  â†’ Clicks drill into Timeline or detail views

Periodic refresh
  â†’ GUILD_ROSTER_UPDATE â†’ RosterReader re-caches â†’ cards update
  â†’ GUILD_NEWS_UPDATE â†’ NewsReader re-caches â†’ activity feed updates
```

## File Structure

```
GuildHistorian/
  Core/
    Constants.lua      â€” Event types, colors, card config, shared styling
    Utils.lua          â€” Display helpers, class coloring, time formatting
    DataModules.lua    â€” AchievementScanner, NewsReader, RosterReader, EventLogReader
    Init.lua           â€” Addon init, slash commands, event registration
  UI/
    MainFrame.xml      â€” Root frame template
    MainFrame.lua      â€” Frame management, tab switching
    Dashboard.lua      â€” Dashboard card layout and rendering
    DashboardCards.lua  â€” Individual card implementations
    Timeline.lua       â€” Scrollable timeline view
    TimelineEntry.lua  â€” Individual timeline row
    FilterBar.lua      â€” Search and filter controls
    SettingsPanel.lua  â€” Settings UI (inline + Blizzard canvas)
    OnThisDayPopup.lua â€” Login popup
    OnThisDayPopup.xml â€” Popup frame template
    MinimapButton.lua  â€” Minimap icon
  Locales/
    enUS.lua           â€” English strings
    deDE.lua, frFR.lua, esES.lua, ptBR.lua
  Libs/
    (unchanged)
  Assets/
    logo_400x400.tga
  README.md
  CHANGELOG.md
  GuildHistorian.toc
```

### Removed Files
- Core/Database.lua (write queue, dedup, local storage)
- Modules/BossKills.lua
- Modules/LootTracker.lua
- Modules/GuildRoster.lua (change detection)
- Modules/Achievements.lua (event recording)
- Modules/MilestoneDetector.lua
- Modules/Notes.lua
- UI/ExportFrame.lua
- UI/StatsPanel.lua (replaced by dashboard cards)
- UI/DetailPanel.lua (replaced by timeline tooltips)

## Success Criteria

1. Fresh install shows populated dashboard and timeline immediately
2. No dependency on local event storage for core functionality
3. Guild achievements timeline goes back to guild's first achievement
4. Dashboard loads in under 1 second with cached data
5. UI feels clean, modern, and uncluttered â€” cards breathe
6. Works identically regardless of installation history
